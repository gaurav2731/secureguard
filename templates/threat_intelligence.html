{% extends "base.html" %}

{% block title %}Threat Intelligence - SecureGuard Enhanced Firewall{% endblock %}

{% block head %}
<style>
    .threat-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 30px;
    }

    .threat-card {
        background: var(--secondary-bg);
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius);
        padding: 20px;
        position: relative;
        overflow: hidden;
    }

    .threat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--neon-red), var(--neon-orange), var(--neon-yellow));
    }

    .threat-level {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: bold;
        text-transform: uppercase;
        margin-bottom: 10px;
    }

    .threat-critical { background: rgba(255, 0, 64, 0.2); color: var(--neon-red); }
    .threat-high { background: rgba(255, 128, 0, 0.2); color: var(--neon-orange); }
    .threat-medium { background: rgba(255, 255, 0, 0.2); color: var(--neon-yellow); }
    .threat-low { background: rgba(0, 255, 0, 0.2); color: var(--neon-green); }

    .threat-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--primary-text);
        margin-bottom: 10px;
    }

    .threat-description {
        color: var(--secondary-text);
        margin-bottom: 15px;
        line-height: 1.5;
    }

    .threat-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.9rem;
        color: var(--muted-text);
    }

    .ml-insights {
        background: linear-gradient(135deg, var(--secondary-bg), var(--tertiary-bg));
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius);
        padding: 25px;
        margin-bottom: 20px;
    }

    .ml-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
    }

    .ml-icon {
        width: 50px;
        height: 50px;
        background: rgba(0, 255, 255, 0.1);
        border: 2px solid var(--neon-blue);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: var(--neon-blue);
    }

    .ml-title {
        font-size: 1.3rem;
        font-weight: 600;
        color: var(--primary-text);
        margin: 0;
    }

    .ml-status {
        color: var(--secondary-text);
        margin: 0;
    }

    .ml-metrics {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }

    .ml-metric {
        text-align: center;
        padding: 15px;
        background: var(--tertiary-bg);
        border-radius: 8px;
        border: 1px solid var(--border-color);
    }

    .ml-metric-value {
        font-size: 1.8rem;
        font-weight: bold;
        color: var(--neon-blue);
        margin-bottom: 5px;
    }

    .ml-metric-label {
        font-size: 0.9rem;
        color: var(--secondary-text);
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .threat-feed {
        margin-top: 20px;
    }

    .feed-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        margin-bottom: 10px;
        transition: var(--transition-fast);
        cursor: pointer;
    }

    .feed-item:hover {
        background: var(--tertiary-bg);
        border-color: var(--neon-blue);
    }

    .feed-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
    }

    .feed-icon.critical { background: rgba(255, 0, 64, 0.2); color: var(--neon-red); }
    .feed-icon.high { background: rgba(255, 128, 0, 0.2); color: var(--neon-orange); }
    .feed-icon.medium { background: rgba(255, 255, 0, 0.2); color: var(--neon-yellow); }
    .feed-icon.low { background: rgba(0, 255, 0, 0.2); color: var(--neon-green); }

    .feed-content {
        flex: 1;
    }

    .feed-title {
        font-weight: 600;
        color: var(--primary-text);
        margin-bottom: 5px;
    }

    .feed-description {
        color: var(--secondary-text);
        font-size: 0.9rem;
        margin-bottom: 8px;
    }

    .feed-meta {
        display: flex;
        gap: 15px;
        font-size: 0.8rem;
        color: var(--muted-text);
    }

    .intelligence-sources {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 20px;
    }

    .source-card {
        background: var(--tertiary-bg);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 15px;
        text-align: center;
    }

    .source-icon {
        font-size: 2rem;
        color: var(--neon-blue);
        margin-bottom: 10px;
    }

    .source-name {
        font-weight: 600;
        color: var(--primary-text);
        margin-bottom: 5px;
    }

    .source-status {
        font-size: 0.9rem;
        color: var(--secondary-text);
    }

    .source-status.active {
        color: var(--neon-green);
    }

    .source-status.inactive {
        color: var(--neon-red);
    }

    .prediction-chart {
        height: 300px;
        background: var(--secondary-bg);
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius);
        padding: 20px;
        margin: 20px 0;
    }

    .anomaly-detection {
        background: var(--secondary-bg);
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius);
        padding: 20px;
        margin: 20px 0;
    }

    .anomaly-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }

    .anomaly-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--primary-text);
        margin: 0;
    }

    .anomaly-status {
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: bold;
    }

    .anomaly-active { background: rgba(255, 0, 64, 0.2); color: var(--neon-red); }
    .anomaly-normal { background: rgba(0, 255, 0, 0.2); color: var(--neon-green); }

    .anomaly-metrics {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 15px;
    }

    .anomaly-metric {
        text-align: center;
    }

    .anomaly-value {
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--neon-blue);
        margin-bottom: 5px;
    }

    .anomaly-label {
        font-size: 0.8rem;
        color: var(--secondary-text);
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .behavior-analysis {
        margin-top: 20px;
    }

    .behavior-pattern {
        background: var(--tertiary-bg);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 10px;
    }

    .pattern-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    .pattern-name {
        font-weight: 600;
        color: var(--primary-text);
    }

    .pattern-confidence {
        font-size: 0.9rem;
        color: var(--neon-green);
    }

    .pattern-description {
        color: var(--secondary-text);
        font-size: 0.9rem;
        margin-bottom: 10px;
    }

    .pattern-stats {
        display: flex;
        gap: 20px;
        font-size: 0.8rem;
        color: var(--muted-text);
    }
</style>
{% endblock %}

{% block content %}
<div class="fade-in">
    <!-- Header -->
    <div class="card">
        <div class="card-header">
            <h1 class="card-title">
                <i class="fas fa-exclamation-triangle"></i>
                Threat Intelligence Hub
            </h1>
            <div class="status-indicator good">
                <div class="status-dot"></div>
                Intelligence Active
            </div>
        </div>
        <div class="card-content">
            <p>Real-time threat intelligence, machine learning insights, and predictive analysis for advanced threat detection.</p>
        </div>
    </div>

    <!-- ML Insights -->
    <div class="ml-insights">
        <div class="ml-header">
            <div class="ml-icon">
                <i class="fas fa-brain"></i>
            </div>
            <div>
                <h2 class="ml-title">Machine Learning Engine</h2>
                <p class="ml-status">Active • Model: XGBoost Classifier • Accuracy: 94.7%</p>
            </div>
        </div>

        <div class="ml-metrics">
            <div class="ml-metric">
                <div class="ml-metric-value">94.7%</div>
                <div class="ml-metric-label">Accuracy</div>
            </div>
            <div class="ml-metric">
                <div class="ml-metric-value">0.02</div>
                <div class="ml-metric-label">False Positive Rate</div>
            </div>
            <div class="ml-metric">
                <div class="ml-metric-value">1,247</div>
                <div class="ml-metric-label">Features</div>
            </div>
            <div class="ml-metric">
                <div class="ml-metric-value">2.3s</div>
                <div class="ml-metric-label">Avg Response Time</div>
            </div>
        </div>
    </div>

    <!-- Threat Grid -->
    <div class="threat-grid">
        <!-- Active Threats -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-skull-crossbones"></i>
                    Active Threats
                </h2>
            </div>
            <div class="card-content">
                <div class="threat-card">
                    <span class="threat-level threat-critical">Critical</span>
                    <h3 class="threat-title">DDoS Attack Pattern Detected</h3>
                    <p class="threat-description">High-volume SYN flood targeting port 80 from multiple sources. Attack intensity increasing.</p>
                    <div class="threat-meta">
                        <span><i class="fas fa-clock"></i> 2 minutes ago</span>
                        <span><i class="fas fa-map-marker-alt"></i> Multiple origins</span>
                    </div>
                </div>

                <div class="threat-card">
                    <span class="threat-level threat-high">High</span>
                    <h3 class="threat-title">SQL Injection Attempt</h3>
                    <p class="threat-description">Suspicious database queries detected from IP 192.168.1.100. Multiple injection patterns identified.</p>
                    <div class="threat-meta">
                        <span><i class="fas fa-clock"></i> 15 minutes ago</span>
                        <span><i class="fas fa-server"></i> Web Server</span>
                    </div>
                </div>

                <div class="threat-card">
                    <span class="threat-level threat-medium">Medium</span>
                    <h3 class="threat-title">Brute Force Login Attempts</h3>
                    <p class="threat-description">Repeated failed authentication attempts against admin panel. IP has been temporarily blocked.</p>
                    <div class="threat-meta">
                        <span><i class="fas fa-clock"></i> 1 hour ago</span>
                        <span><i class="fas fa-user-shield"></i> Auth System</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Anomaly Detection -->
        <div class="anomaly-detection">
            <div class="anomaly-header">
                <h3 class="anomaly-title">
                    <i class="fas fa-chart-line"></i>
                    Anomaly Detection
                </h3>
                <span class="anomaly-status anomaly-normal">Normal</span>
            </div>

            <div class="anomaly-metrics">
                <div class="anomaly-metric">
                    <div class="anomaly-value">2.1</div>
                    <div class="anomaly-label">Z-Score</div>
                </div>
                <div class="anomaly-metric">
                    <div class="anomaly-value">98.5%</div>
                    <div class="anomaly-label">Confidence</div>
                </div>
                <div class="anomaly-metric">
                    <div class="anomaly-value">0.05</div>
                    <div class="anomaly-label">Threshold</div>
                </div>
                <div class="anomaly-metric">
                    <div class="anomaly-value">1,420</div>
                    <div class="anomaly-label">Samples/Hour</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Threat Intelligence Feed -->
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">
                <i class="fas fa-rss"></i>
                Threat Intelligence Feed
            </h2>
            <a href="#" class="btn">View All</a>
        </div>
        <div class="card-content">
            <div class="threat-feed">
                <div class="feed-item">
                    <div class="feed-icon critical">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="feed-content">
                        <div class="feed-title">New Ransomware Variant Detected</div>
                        <div class="feed-description">Ryuk ransomware variant targeting Windows servers with enhanced encryption algorithms.</div>
                        <div class="feed-meta">
                            <span><i class="fas fa-calendar"></i> Today</span>
                            <span><i class="fas fa-globe"></i> Global</span>
                            <span><i class="fas fa-tag"></i> Ransomware</span>
                        </div>
                    </div>
                </div>

                <div class="feed-item">
                    <div class="feed-icon high">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="feed-content">
                        <div class="feed-title">Zero-Day Vulnerability in Apache</div>
                        <div class="feed-description">CVE-2024-1234: Remote code execution vulnerability in Apache HTTP Server 2.4.x</div>
                        <div class="feed-meta">
                            <span><i class="fas fa-calendar"></i> 2 days ago</span>
                            <span><i class="fas fa-server"></i> Web Servers</span>
                            <span><i class="fas fa-tag"></i> Zero-Day</span>
                        </div>
                    </div>
                </div>

                <div class="feed-item">
                    <div class="feed-icon medium">
                        <i class="fas fa-user-secret"></i>
                    </div>
                    <div class="feed-content">
                        <div class="feed-title">APT Group Targeting Financial Sector</div>
                        <div class="feed-description">State-sponsored actors using novel phishing techniques against banking institutions.</div>
                        <div class="feed-meta">
                            <span><i class="fas fa-calendar"></i> 1 week ago</span>
                            <span><i class="fas fa-building"></i> Financial</span>
                            <span><i class="fas fa-tag"></i> APT</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Intelligence Sources -->
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">
                <i class="fas fa-database"></i>
                Intelligence Sources
            </h2>
        </div>
        <div class="card-content">
            <div class="intelligence-sources">
                <div class="source-card">
                    <div class="source-icon">
                        <i class="fas fa-globe"></i>
                    </div>
                    <h4 class="source-name">AlienVault OTX</h4>
                    <p class="source-status active">Active • 1,247 pulses</p>
                </div>

                <div class="source-card">
                    <div class="source-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h4 class="source-name">MISP</h4>
                    <p class="source-status active">Active • 892 events</p>
                </div>

                <div class="source-card">
                    <div class="source-icon">
                        <i class="fas fa-microchip"></i>
                    </div>
                    <h4 class="source-name">Cisco Talos</h4>
                    <p class="source-status active">Active • 15,430 signatures</p>
                </div>

                <div class="source-card">
                    <div class="source-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    <h4 class="source-name">VirusTotal</h4>
                    <p class="source-status active">Active • 2.1M samples</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Behavior Analysis -->
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">
                <i class="fas fa-search"></i>
                Behavior Analysis
            </h2>
        </div>
        <div class="card-content">
            <div class="behavior-analysis">
                <div class="behavior-pattern">
                    <div class="pattern-header">
                        <span class="pattern-name">Port Scanning Pattern</span>
                        <span class="pattern-confidence">95% confidence</span>
                    </div>
                    <p class="pattern-description">Sequential port scanning behavior detected across multiple IP ranges. Pattern suggests reconnaissance activity.</p>
                    <div class="pattern-stats">
                        <span><i class="fas fa-clock"></i> Duration: 45 min</span>
                        <span><i class="fas fa-network-wired"></i> Ports: 1-1024</span>
                        <span><i class="fas fa-server"></i> Targets: 15 hosts</span>
                    </div>
                </div>

                <div class="behavior-pattern">
                    <div class="pattern-header">
                        <span class="pattern-name">Data Exfiltration Attempt</span>
                        <span class="pattern-confidence">87% confidence</span>
                    </div>
                    <p class="pattern-description">Large outbound data transfers to unusual destinations. Potential data theft in progress.</p>
                    <div class="pattern-stats">
                        <span><i class="fas fa-upload"></i> Volume: 2.3 GB</span>
                        <span><i class="fas fa-clock"></i> Duration: 12 min</span>
                        <span><i class="fas fa-globe"></i> Destination: Unknown</span>
                    </div>
                </div>

                <div class="behavior-pattern">
                    <div class="pattern-header">
                        <span class="pattern-name">Command and Control Communication</span>
                        <span class="pattern-confidence">92% confidence</span>
                    </div>
                    <p class="pattern-description">Encrypted communications with known malicious infrastructure. Botnet activity suspected.</p>
                    <div class="pattern-stats">
                        <span><i class="fas fa-exchange-alt"></i> Frequency: 30 sec</span>
                        <span><i class="fas fa-lock"></i> Encrypted: Yes</span>
                        <span><i class="fas fa-server"></i> C2 Servers: 3</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize threat intelligence dashboard
    console.log('Threat Intelligence Hub loaded');

    // Add click handlers for threat items
    document.querySelectorAll('.feed-item').forEach(item => {
        item.addEventListener('click', function() {
            // In a real implementation, this would open threat details
            alert('Threat details would open here');
        });
    });

    // Simulate real-time updates
    setInterval(() => {
        // Update anomaly detection status randomly
        const statuses = ['anomaly-normal', 'anomaly-active'];
        const randomStatus = statuses[Math.floor(Math.random() * statuses.length)];
        const anomalyStatus = document.querySelector('.anomaly-status');
        anomalyStatus.className = `anomaly-status ${randomStatus}`;
        anomalyStatus.textContent = randomStatus === 'anomaly-normal' ? 'Normal' : 'Anomaly Detected';
    }, 30000); // Update every 30 seconds
});
</script>
{% endblock %}
