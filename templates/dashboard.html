{% extends "base.html" %}

{% block title %}Dashboard - SecureGuard Enhanced Firewall{% endblock %}

{% block head %}
<style>
    .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .threat-level {
        font-size: 1.5rem;
        font-weight: bold;
        text-align: center;
        padding: 10px;
        border-radius: var(--border-radius);
        margin: 10px 0;
    }

    .threat-low { background: rgba(0, 255, 0, 0.1); color: var(--neon-green); }
    .threat-medium { background: rgba(255, 128, 0, 0.1); color: var(--neon-orange); }
    .threat-high { background: rgba(255, 0, 64, 0.1); color: var(--neon-red); }

    .recent-activity {
        max-height: 400px;
        overflow-y: auto;
    }

    .activity-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 12px 0;
        border-bottom: 1px solid var(--border-color);
    }

    .activity-item:last-child {
        border-bottom: none;
    }

    .activity-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
    }

    .activity-icon.blocked { background: rgba(255, 0, 64, 0.2); color: var(--neon-red); }
    .activity-icon.allowed { background: rgba(0, 255, 0, 0.2); color: var(--neon-green); }
    .activity-icon.warning { background: rgba(255, 128, 0, 0.2); color: var(--neon-orange); }

    .activity-details {
        flex: 1;
    }

    .activity-details h4 {
        margin: 0 0 5px 0;
        font-size: 0.9rem;
        color: var(--primary-text);
    }

    .activity-details p {
        margin: 0;
        font-size: 0.8rem;
        color: var(--muted-text);
    }

    .system-status {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 15px;
    }

    .status-item {
        text-align: center;
        padding: 15px;
        background: var(--tertiary-bg);
        border-radius: var(--border-radius);
        border: 1px solid var(--border-color);
    }

    .status-item h4 {
        margin: 0 0 10px 0;
        color: var(--secondary-text);
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .status-value {
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--neon-blue);
    }

    .protection-score {
        text-align: center;
        margin: 20px 0;
    }

    .score-circle {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        border: 8px solid var(--border-color);
        margin: 0 auto 15px;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        font-weight: bold;
        color: var(--neon-blue);
    }

    .score-circle.excellent {
        border-color: var(--neon-green);
        color: var(--neon-green);
    }

    .score-circle.good {
        border-color: var(--neon-blue);
        color: var(--neon-blue);
    }

    .score-circle.fair {
        border-color: var(--neon-orange);
        color: var(--neon-orange);
    }
</style>
{% endblock %}

{% block content %}
<div class="fade-in">
    <!-- Header Section -->
    <div class="card">
        <div class="card-header">
            <h1 class="card-title">
                <i class="fas fa-tachometer-alt"></i>
                SecureGuard Dashboard
            </h1>
            <div class="status-indicator good">
                <div class="status-dot"></div>
                System Active
            </div>
        </div>
        <div class="card-content">
            <p>Welcome to the SecureGuard Enhanced Firewall Control Center. Monitor real-time threats, manage firewall rules, and analyze system performance.</p>
        </div>
    </div>

    <!-- Key Metrics -->
    <div class="dashboard-grid">
        <div class="metric-card">
            <div class="metric-value">{{ packet_count | default(0) }}</div>
            <div class="metric-label">Packets Processed</div>
        </div>

        <div class="metric-card">
            <div class="metric-value">{{ blocked_count | default(0) }}</div>
            <div class="metric-label">Threats Blocked</div>
        </div>

        <div class="metric-card">
            <div class="metric-value">{{ max_packets | default(5000000) }}</div>
            <div class="metric-label">Max Capacity</div>
        </div>

        <div class="metric-card">
            <div class="metric-value">{{ protection_status.score | default(95) }}%</div>
            <div class="metric-label">Protection Score</div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="grid grid-2">
        <!-- Recent Activity -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-history"></i>
                    Recent Activity
                </h2>
                <a href="{{ url_for('analytics') }}" class="btn">View All</a>
            </div>
            <div class="card-content">
                <div class="recent-activity">
                    {% for block in recent_blocks[:10] %}
                    <div class="activity-item">
                        <div class="activity-icon blocked">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <div class="activity-details">
                            <h4>IP Blocked: {{ block[0] }}</h4>
                            <p>{{ block[2] }} â€¢ {{ block[1] }} occurrences</p>
                        </div>
                    </div>
                    {% endfor %}
                    {% if not recent_blocks %}
                    <div class="activity-item">
                        <div class="activity-icon allowed">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="activity-details">
                            <h4>No recent threats detected</h4>
                            <p>System is operating normally</p>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- System Status -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-server"></i>
                    System Status
                </h2>
                <a href="{{ url_for('system_monitor') }}" class="btn">Details</a>
            </div>
            <div class="card-content">
                <div class="system-status">
                    <div class="status-item">
                        <h4>CPU Usage</h4>
                        <div class="status-value">{{ system_metrics.cpu_usage | default(0) | round(1) }}%</div>
                    </div>
                    <div class="status-item">
                        <h4>Memory</h4>
                        <div class="status-value">{{ system_metrics.memory_usage | default(0) | round(1) }}%</div>
                    </div>
                    <div class="status-item">
                        <h4>Disk</h4>
                        <div class="status-value">{{ system_metrics.disk_usage | default(0) | round(1) }}%</div>
                    </div>
                    <div class="status-item">
                        <h4>Connections</h4>
                        <div class="status-value">{{ system_metrics.network_connections | default(0) }}</div>
                    </div>
                </div>

                <div class="protection-score">
                    <div class="score-circle {{ 'excellent' if protection_status.score >= 90 else 'good' if protection_status.score >= 70 else 'fair' }}">
                        {{ protection_status.score | default(95) }}
                    </div>
                    <h3>{{ protection_status.status | default('Excellent') | title }} Protection</h3>
                    <p>{{ protection_status.active_protections | join(', ') if protection_status.active_protections else 'Basic protection active' }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Threat Intelligence & ML Status -->
    <div class="grid grid-2">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-brain"></i>
                    ML Detection Status
                </h2>
            </div>
            <div class="card-content">
                {% if ml_status.enabled %}
                <div class="status-indicator good">
                    <i class="fas fa-check-circle"></i>
                    Machine Learning Active
                </div>
                <p><strong>Model:</strong> {{ ml_status.model_loaded | default('Unknown') }}</p>
                <p><strong>Features:</strong> {{ ml_status.features_count | default(0) }}</p>
                <p><strong>Last Training:</strong> {{ ml_status.last_training | default('Never') }}</p>
                {% else %}
                <div class="status-indicator warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    ML Detection Disabled
                </div>
                <p>Machine learning features are not available.</p>
                {% endif %}
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-database"></i>
                    Threat Intelligence
                </h2>
                <a href="{{ url_for('threat_intelligence') }}" class="btn">Manage</a>
            </div>
            <div class="card-content">
                {% for type_name, count in threat_intelligence_stats.items() %}
                <div class="status-item">
                    <h4>{{ type_name | replace('_', ' ') | title }}</h4>
                    <div class="status-value">{{ count | default(0) }}</div>
                </div>
                {% endfor %}
                {% if not threat_intelligence_stats %}
                <p>No threat intelligence data available.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">
                <i class="fas fa-bolt"></i>
                Quick Actions
            </h2>
        </div>
        <div class="card-content">
            <div class="grid grid-4">
                <a href="{{ url_for('control_panel') }}" class="btn btn-primary">
                    <i class="fas fa-cogs"></i>
                    Manage Rules
                </a>
                <a href="{{ url_for('analytics') }}" class="btn">
                    <i class="fas fa-chart-line"></i>
                    View Analytics
                </a>
                <a href="{{ url_for('file_manager') }}" class="btn">
                    <i class="fas fa-folder-open"></i>
                    Browse Files
                </a>
                <a href="{{ url_for('api_tester') }}" class="btn">
                    <i class="fas fa-code"></i>
                    Test API
                </a>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
